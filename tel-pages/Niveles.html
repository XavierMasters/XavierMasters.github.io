<!DOCTYPE html>
<html>
<head>
    <title></title>
	<meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="format-detection" content="telephone=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="MobileOptimized" content="176" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="robots" content="noindex,nofollow" />

    <link rel="stylesheet" href="../Content/bootstrap-4.3.1.min.css" />
    <link rel="stylesheet" href="../Content/font-awesome-4.7.0.min.css" />

    <script src="../Content/js/jquery-3.4.1.min.js"></script>
    <script src="../Content/js/bootstrap-4.3.1.min.js"></script>
	<!-- Load the Telegram Library -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
	<form>
		<section>
			<div class="row">
				<div id="btn_status" class="hint" style="display: none;" class="col-lg-12 col-md-12 col-sm-12">
				</div>
				<div class="col-lg-12 col-md-12 col-sm-12">
					Data passed to webview.
					<span id="webview_data_status" class="status_need">Checking hash...</span>
				</div>
				<div class="col-lg-12 col-md-12 col-sm-12">
					<div class="card card-shadow">
						<div class="card-header">
							<h4>Ingresa la información de los niveles:</h4>
						</div>
						<div class="card-body">
							<div class="form-row">
								<div class="form-group  col-lg-12 col-md-12 col-sm-12">
									<span>Aceite de motor</span>
									<input type="number" id="txtAceitoMotor" name="txtAceitoMotor" min="0.5" max="4.0" step="0.5" class="form-control" onchange="validateRange(this)">
								</div>
							</div>
							<div class="form-row">
								<div class="form-group  col-lg-12 col-md-12 col-sm-12">
									<span>Anticongelante</span>
									<input type="number" id="txtAnticongelante" name="txtAnticongelante" min="0.5" max="4" step="0.5" class="form-control" onchange="validateRange(this)">
								</div>
							</div>
							<div class="form-row">
								<div class="form-group  col-lg-12 col-md-12 col-sm-12">
									<span>Aceite Hidráulico</span>
									<input type="number" id="txtAceiteHidraulico" name="txtAceiteHidraulico" min="0.25" max="1" step="0.25" class="form-control" onchange="validateRange(this)">
								</div>
							</div>
							<div class="form-row">
								<div class="form-group  col-lg-12 col-md-12 col-sm-12">
									<span>Aceite Transmisión Automática</span>
									<input type="number" id="txtAceiteTransmisionAut" name="txtAceiteTransmisionAut" min="0.25" max="1" step="0.25" class="form-control" onchange="validateRange(this)">
								</div>
							</div>
							<div class="form-row">
								<div class="form-group col-lg-12 col-md-12 col-sm-12">
									<div class="form-check form-check-inline">
										<span class="form-check-label">Líquido de Frenos&nbsp;&nbsp;</span>
										<input type="checkbox" id="chkLiqFrenos" name="chkLiqFrenos" class="form-check-input">
									</div>
								</div>
							</div>
							<div class="form-row">
								<div class="form-group  col-lg-12 col-md-12 col-sm-12">
									<div class="form-check form-check-inline">
										<span class="form-check-label">Agua Parabrisas&nbsp;&nbsp;</span>
										<input type="checkbox" id="chkAguaP" name="chkAguaP" class="form-check-input">
									</div>
								</div>
							</div>
							<div class="form-row">
								<div class="form-group  col-lg-12 col-md-12 col-sm-12">
									<div class="form-check form-check-inline">
										<span class="form-check-label">Embrague&nbsp;&nbsp;</span>
										<input type="checkbox" id="chkEmbrague" name="chkEmbrague" class="form-check-input">
									</div>
								</div>
							</div>
							<div class="form-row">
								<div class="form-group  col-lg-12 col-md-12 col-sm-12">
									<div class="form-check form-check-inline">
										<span class="form-check-label">Publicidad&nbsp;&nbsp;</span>
										<input type="checkbox" id="chkPublicidadP" name="chkPublicidad" class="form-check-input">
									</div>
								</div>
							</div>
							<div class="form-row">
								<div class="form-group  col-lg-12 col-md-12 col-sm-12">
									<div class="form-check form-check-inline">
										<span class="form-check-label">Terminales&nbsp;&nbsp;</span>
										<input type="checkbox" id="chkTerminales" name="chkTerminales" class="form-check-input">
									</div>
								</div>
							</div>
							   
						</div>
						<div class="card-footer text-muted">
							<button id="btnGauardar" class="btn btn-primary" onclick="DemoApp.sendMessage('');">« Guardar »</button>
						</div>
					</div>
				</div>
			</div>
		</section>
	</form>
	
	<script type="application/javascript">
		
		function validateRange(me) {
			//console.log(me.id + ' ' + me.value);
			var value = 0;
			switch (me.id) {
				case "txtAceitoMotor":
				case "txtAnticongelante":
					value = me.value;
					if(value < 0.5 || value > 4)
						me.value = "";
				break;
				case "txtAceiteHidraulico":
				case "txtAceiteTransmisionAut":
					value = me.value;
					if(value < 0.25 || value > 1)
						me.value = "";
				break;
			}
		}
		
		const DemoApp = {
			initData: Telegram.WebApp.initData || '',
			initDataUnsafe: Telegram.WebApp.initDataUnsafe || {},
			MainButton: Telegram.WebApp.MainButton,

			init(options) {
				document.body.style.visibility = '';
				Telegram.WebApp.ready();
				Telegram.WebApp.MainButton.setParams({
					text: 'CLOSE WEBVIEW',
					is_visible: true
				}).onClick(DemoApp.close);
			},
			expand() {
				Telegram.WebApp.expand();
			},
			close() {
				Telegram.WebApp.close();
			},
			toggleMainButton(el) { // NO SE UTILIZA POR EL MOMENTO, ES PARA OCULTAR EL MAIN BUTTON TELGRAM
				const mainButton = Telegram.WebApp.MainButton;
				if (mainButton.isVisible) {
					mainButton.hide();
					el.innerHTML = 'Show Main Button';
				} else {
					mainButton.show();
					el.innerHTML = 'Hide Main Button';
				}
			},
			
			// actions
			sendMessage(msg_id, with_webview) {
				if (!DemoApp.initDataUnsafe.query_id) {
					alert('WebViewQueryId not defined');
					return;
				}

				document.querySelectorAll('button').forEach((btn) => btn.disabled = true);

				const btn = document.querySelector('#btn_status');
				btn.textContent = 'Sending...';

				DemoApp.apiRequest('sendMessage', {
					msg_id: msg_id || '',
					with_webview: !DemoApp.initDataUnsafe.receiver && with_webview ? 1 : 0
				}, function(result) {
					document.querySelectorAll('button').forEach((btn) => btn.disabled = false);

					if (result.response) {
						if (result.response.ok) {
							btn.textContent = 'Message sent successfully!';
							btn.className = 'ok';
							btn.style.display = 'block';
						} else {
							btn.textContent = result.response.description;
							btn.className = 'err';
							btn.style.display = 'block';
							alert(result.response.description);
						}
					} else if (result.error) {
						btn.textContent = result.error;
						btn.className = 'err';
						btn.style.display = 'block';
						alert(result.error);
					} else {
						btn.textContent = 'Unknown error';
						btn.className = 'err';
						btn.style.display = 'block';
						alert('Unknown error');
					}
				});
			},
			checkInitData() {
				const webViewStatus = document.querySelector('#webview_data_status');
				if (DemoApp.initDataUnsafe.query_id &&
					DemoApp.initData &&
					webViewStatus.classList.contains('status_need')
				) {
					webViewStatus.classList.remove('status_need');
					DemoApp.apiRequest('checkInitData', {}, function(result) {
						if (result.ok) {
							webViewStatus.textContent = 'Hash is correct (async)';
							webViewStatus.className = 'ok';
						} else {
							webViewStatus.textContent = result.error + ' (async)';
							webViewStatus.className = 'err';
						}
					});
				}
			}
		}
		
		DemoApp.checkInitData();
		DemoApp.init();
	</script>
    
</body>
</html>
